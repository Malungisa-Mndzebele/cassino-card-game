RewriteEngine On

# Handle CORS preflight requests
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# Rewrite API requests to PHP proxy
RewriteRule ^cassino/api/(.*)$ cassino/backend/start.php [QSA,L]

# Rewrite WebSocket requests
RewriteCond %{HTTP:Upgrade} websocket [NC]
RewriteCond %{HTTP:Connection} upgrade [NC]
RewriteRule ^cassino/ws/(.*)$ ws://localhost:8000/ws/$1 [P,L]

# Serve static files directly
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Serve manifest.json and favicon.svg
RewriteRule ^cassino/manifest\.json$ cassino/manifest.json [L]
RewriteRule ^cassino/favicon\.svg$ cassino/favicon.svg [L]

# Fallback to index.html for client-side routing
RewriteRule ^cassino/.*$ cassino/index.html [QSA,L]